$PSDocId: Document Version 1.0 for Runtime Library Version 3.3$
プログラマ各位

	Exec 関連の処理とスタックポインタについて

					SCE開発部


日頃のお引き立てありがとうございます。本日は上記の事項に関して
お知らせすることがありますので以下の記事をお読みになって必要であれば
配布するモジュールを御使用になっていただきたく存じます。


スタックポインタの設定。

libsn.lib は PCファイルシステム関連の関数を使用するに当たって有用なだ
けでなく、データ領域のクリアやスタックポインタの設定など、main の前に
行なわれる処理ルーチンを含んでおり、ccpsx を始めとした一連の手続きを
行なって生成されたファイルはかならずこの部分 ( __main)を含むことになり
ます。libsn.lib は H2000 のディップスイッチを読み、可能な限り奥深くに
スタックをとりますのでこれを 2MB,8MB で使い分けることができるようにし
たのが 2MByte.OBJ および 8MByte.OBJ です。

ここで問題になるのは「実行ファイルを呼び出し、その実行が終ると呼び出し
側プロセスに帰ってくる」ような処理をしたい場合です。呼び出される側の実
行プログラムのスタックポインタの値はリンカファイルをちゃんと書かないと
決定できない上、Exec 構造体にその数値を入れたところで main の事前処理
でこの設定が無効になってしまいます。

つまり「呼び出した側のスタック内容を呼び出された側ののプログラムが破壊
してしまうため、呼び出された側のプログラムが終了し、復帰しようとした時
には復帰するためのアドレス情報がないためハングアップしてしまう」のです。
呼び出される側のプログラムは2MBytes.OBJ,8MBytes.OBJ,libsn.lib のいずれ
にも依存しない main の前処理が必要になります。それは「スタックの設定は
何もしない」という前処理です。

呼び出される側（そして復帰が予定されている）プログラムは本日配布する
NONE.OBJ をリンクすることによって、この条件を満たすことができます。
使用方法は 2MByte.OBJ と全く同じですので、この場での詳細は記述を控えさ
せていただきます。
